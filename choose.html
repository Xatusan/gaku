<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Choose Your Path</title>
  <style>
    html,body {
      margin: 0;
      padding: 0;
      height: 100%;
      color: #eaf6ff;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #050c16;
    }
    /* Starfield background */
    .bg-stars::before, .bg-stars::after {
      content:"";
      position: fixed;
      top:-50%;
      left:-50%;
      width:200%;
      height:200%;
      background: radial-gradient(circle, rgba(255,255,255,0.2) 1px, transparent 1px);
      background-size: 5px 5px;
      animation: spin1 120s linear infinite;
      pointer-events:none;
      z-index: -2;
    }
    .bg-stars::after {
      background: radial-gradient(circle, rgba(255,255,255,0.3) 1px, transparent 1px);
      background-size: 8px 8px;
      animation: spin2 200s linear infinite;
    }
    @keyframes spin1 { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes spin2 { from { transform: rotate(0deg); } to { transform: rotate(-360deg); } }

    /* Intro overlay */
    .overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items:center;
      justify-content:center;
      background: rgba(0,8,20,0.95);
      z-index: 100;
      pointer-events: none;
      opacity: 1;
      filter: blur(8px);
      transform: scale(1.1);
      transition:
        opacity 1.4s ease-out,
        filter 1.4s ease-out,
        transform 1.4s ease-out;
    }
    .overlay h1 {
      font-size: clamp(2rem, 6vw + .5rem, 4rem);
      text-shadow: 0 0 18px #6ACCFD, 0 0 40px #6ACCFD;
      animation: overlaypulse 4s infinite alternate;
    }
    @keyframes overlaypulse { from { opacity: 0.85; } to { opacity: 1; } }

    /* Page layout */
    #container {
      position: relative;
      height: 100%;
      display: grid;
      grid-template-columns: 1fr 600px;
      gap: 20px;
      padding: 18px;
      box-sizing: border-box;
    }
    @media (max-width: 900px) { #container { grid-template-columns: 1fr 520px; } }
    @media (max-width: 640px) { #container { grid-template-columns: 1fr; } }

    /* Class cards */
    .cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-auto-rows: auto;
      gap: 14px;
      overflow-y: auto;
      padding-right: 4px;
    }
    .card {
      position: relative;
      width: 100%;
      background: rgba(0,0,30,0.5);
      border: 1px solid rgba(134,241,255,0.15);
      border-radius: 12px;
      cursor: pointer;
      transition: transform .25s, box-shadow .25s, border-color .25s;
      overflow: visible;
    }
    .card:hover { transform: translateY(-4px); box-shadow: 0 0 12px #f9d76c, 0 0 22px #6accfd; border-color: rgba(250,216,96,0.5); }
    .card.selected { box-shadow: 0 0 15px #f9d76c, 0 0 35px #f9d76c; border-color: rgba(250,216,96,0.8); }
    .card .thumb {
      width: 100%;
      height: 160px;
      background: radial-gradient(circle at 50% 50%, rgba(14,31,43,0.6), rgba(9,20,34,0.85));
      display: flex; align-items: center; justify-content: center;
      overflow: visible;
    }
    .card .thumb img { max-width: 100%; max-height: 100%; object-fit: contain; transition: transform .3s, filter .3s; }
    .card:hover .thumb img { transform: scale(1.05); filter: drop-shadow(0 0 6px rgba(250,216,96,0.4)) drop-shadow(0 0 12px rgba(250,216,96,0.25)); }
    .card .name { padding: 8px; text-align: center; font-weight: 600; font-size: 1rem; }

    /* Hero panel */
    .hero { display:flex; flex-direction:column; align-items:center; background: rgba(0,0,25,0.6); border:1px solid rgba(134,241,255,0.15); border-radius:14px; padding:16px; box-sizing:border-box; overflow:hidden; }
    .hero .image-container { width:100%; height:380px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; }
    .hero .image-container img { max-width:100%; max-height:100%; object-fit:contain; border-radius:12px; filter:drop-shadow(0 0 8px rgba(250,216,96,0.5)); transition: transform .3s; }
    .hero .image-container:hover img { transform:scale(1.02); }
    .hero h2 { margin:12px 0 6px; font-size:1.4rem; text-align:center; }
    .hero p.flavor { margin:0 0 8px; font-size:.95rem; text-align:center; opacity:.9; }
    .hero ul.abilities { list-style:none; padding:0; margin:0 0 12px; text-align:center; font-size:.9rem; }
    .hero ul.abilities li { margin-bottom:4px; }
    .attributes { width:100%; display:grid; grid-template-columns: repeat(3, 1fr); gap:8px; margin-bottom:8px; }
    .attr { display:flex; align-items:center; justify-content:space-between; padding:6px; background:rgba(0,0,30,0.5); border-radius:8px; font-size:.95rem; }
    .attr .label { flex:0 0 36px; text-shadow:0 0 6px rgba(106,204,253,0.5); }
    .attr .value { margin-left:auto; margin-right:6px; font-weight:bold; }
    .attr button.plus { background:rgba(106,204,253,0.25); border:1px solid rgba(134,241,255,0.5); border-radius:50%; width:26px; height:26px; color:#eaf6ff; font-weight:bold; line-height:1; cursor:pointer; transition: background .3s, box-shadow .3s; }
    .attr button.plus:hover:not(:disabled) { background: rgba(250,216,96,0.35); box-shadow:0 0 6px rgba(250,216,96,0.4); }
    .attr button.plus:disabled { opacity:.5; cursor:not-allowed; }
    .footer { text-align:center; margin-top:auto; }
    .footer button { margin-top:8px; padding:10px 24px; background:rgba(106,204,253,0.2); border:2px solid #6accfd; border-radius:24px; color:#eaf6ff; font-size:1rem; cursor:pointer; transition: background .3s, box-shadow .3s; }
    .footer button:hover:not(:disabled) { background: rgba(250,216,96,0.25); box-shadow: 0 0 12px rgba(250,216,96,0.45), 0 0 18px rgba(106,204,253,0.4); }
    .footer button:disabled { opacity:.5; cursor:not-allowed; }
    .points-remaining { margin-bottom:4px; font-size:.85rem; opacity:.8; }

    /* Name input */
    .name-row { width:100%; margin-bottom:10px; display:flex; flex-direction:column; align-items:stretch; }
    .name-row label { font-size:.9rem; margin-bottom:4px; opacity:.85; }
    .name-row input { width:100%; padding:8px 10px; font-size:1rem; background:rgba(0,0,25,0.6); border:1px solid rgba(134,241,255,0.4); border-radius:8px; color:#eaf6ff; outline:none; transition:border-color .2s; }
    .name-row input:focus { border-color: rgba(250,216,96,0.6); }

    /* Abilities selection */
    .abilities-selection { display:flex; flex-wrap:wrap; gap:6px; justify-content:center; margin-bottom:8px; }
    .ability-chip { padding:4px 10px; font-size:.9rem; border-radius:16px; border:1px solid rgba(134,241,255,0.5); background:rgba(0,0,30,0.5); color:#eaf6ff; cursor:pointer; transition: background .25s, box-shadow .25s, border-color .25s; }
    .ability-chip:hover:not(.selected):not(.disabled) { background: rgba(250,216,96,0.25); border-color: rgba(250,216,96,0.5); box-shadow:0 0 6px rgba(250,216,96,0.35); }
    .ability-chip.selected { background: rgba(250,216,96,0.35); border-color: rgba(250,216,96,0.7); box-shadow: 0 0 8px rgba(250,216,96,0.5), 0 0 12px rgba(134,241,255,0.4); }
    .ability-chip.disabled { opacity:.5; cursor:not-allowed; }

    /* Summary modal */
    .modal { position:fixed; inset:0; background:rgba(0,8,20,0.85); display:none; align-items:center; justify-content:center; z-index:200; }
    .modal-content { background:rgba(0,0,25,0.8); border:1px solid rgba(134,241,255,0.3); border-radius:14px; padding:20px; max-width:460px; width:90%; color:#eaf6ff; box-shadow:0 0 20px rgba(250,216,96,0.4); text-align:center; }
    .modal-content h2 { margin-top:0; margin-bottom:12px; font-size:1.6rem; }
    .modal-content p { margin:6px 0; font-size:1rem; }
    .modal-content button { margin-top:14px; padding:8px 20px; border-radius:20px; border:2px solid #6accfd; background:rgba(106,204,253,0.25); color:#eaf6ff; font-size:1rem; cursor:pointer; transition: background .3s; }
    .modal-content button:hover { background: rgba(250,216,96,0.25); box-shadow: 0 0 12px rgba(250,216,96,0.45), 0 0 18px rgba(106,204,253,0.4); }
    .modal-buttons { display:flex; justify-content:center; gap:12px; margin-top:14px; }

    /* Cards scrollbar */
    .cards { scrollbar-width:thin; scrollbar-color: rgba(106,204,253,0.4) transparent; }
    .cards::-webkit-scrollbar { width:8px; }
    .cards::-webkit-scrollbar-track { background:transparent; }
    .cards::-webkit-scrollbar-thumb { background: rgba(106,204,253,0.4); border-radius:4px; }
  </style>
</head>
<body>
  <div class="bg-stars"></div>
  <!-- Ambient music -->
  <audio id="ambient" src="sounds/space_ambient.mp3" loop autoplay muted playsinline preload="auto"></audio>
  <div class="overlay" id="overlay">
    <h1>Choose your path…</h1>
  </div>
  <div id="container">
    <div class="cards" id="cards"></div>
    <div class="hero" id="hero">
      <div class="image-container">
        <img id="heroImg" src="" alt="">
      </div>
      <h2 id="heroName">Select a class</h2>
      <p class="flavor" id="heroFlavor">Pick a character on the left to see details.</p>
      <!-- Character name input -->
      <div class="name-row">
        <label for="charName">Name</label>
        <input id="charName" type="text" placeholder="Enter your name">
      </div>
      <!-- Ability selection chips -->
      <div class="abilities-selection" id="abilitiesSelection"></div>
      <div class="points-remaining" id="pointsRemaining">2 points remaining</div>
      <div class="attributes" id="attrs"></div>
      <div class="footer">
        <button id="continueBtn" disabled>Continue</button>
      </div>
    </div>
  </div>

  <!-- Summary modal -->
  <div id="summaryModal" class="modal">
    <div class="modal-content">
      <h2>Character Summary</h2>
      <p><strong>Name:</strong> <span id="sumName">—</span></p>
      <p><strong>Class:</strong> <span id="sumClass">—</span></p>
      <p><strong>Abilities:</strong> <span id="sumAbilities">—</span></p>
      <div class="modal-buttons">
        <button id="backBtn">Back</button>
        <button id="proceedBtn">Proceed</button>
      </div>
    </div>
  </div>

  <script>
    // Fade out overlay & ambient music
    window.addEventListener('load', () => {
      setTimeout(() => {
        const ov = document.getElementById('overlay');
        ov.style.opacity = '0'; ov.style.filter = 'blur(0)'; ov.style.transform = 'scale(1)';
        setTimeout(() => { if (ov.parentElement) ov.remove(); }, 1400);
      }, 800);
      try {
        const ambient = document.getElementById('ambient');
        if (ambient) {
          ambient.volume = 0.25;
          const unlocked = sessionStorage.getItem('ambientUnlock') === '1';
          if (unlocked) ambient.muted = false;
          ambient.play().then(() => { if (!unlocked) setTimeout(() => { ambient.muted = false; }, 50); }).catch(() => {});
        }
      } catch (e) {}
    });

    // Define classes
    const CLASSES = [
      { name: "Warrior", slug: "warrior", role: "Frontliner", flavor: "A hardened fighter who holds the line with blade and grit.", abilities: ["Sword Slash", "Stand Firm", "Curve Slash"], base: { STR:10, AGI:7, END:10, SPC:6, INT:5, WIS:6 }, img: "warrior.jpg" },
      { name: "Berserker", slug: "berserker", role: "Frontliner", flavor: "A wild fighter whose fury peaks when wounded.", abilities: ["Fury", "Wild Hit", "War Cry"], base: { STR:11, AGI:7, END:10, SPC:6, INT:5, WIS:5 }, img: "berserker.jpg" },
      { name: "Samurai", slug: "samurai", role: "Frontliner", flavor: "A disciplined swordmaster, swift and precise.", abilities: ["Iaijutsu", "Focus", "Calm Strike"], base: { STR:9, AGI:9, END:7, SPC:7, INT:5, WIS:7 }, img: "samurai.jpg" },
      { name: "Spearfighter", slug: "spearfighter", role: "Frontliner", flavor: "A relentless lancer who pierces armor and resolve.", abilities: ["Thrust", "Jab", "Spear Swipe"], base: { STR:8, AGI:8, END:8, SPC:8, INT:5, WIS:7 }, img: "spearfighter.jpg" },
      { name: "Dragon Knight", slug: "dragonknight", role: "Frontliner", flavor: "A knight armored in scales and draconic might.", abilities: ["Drake Jab", "Scale Armor", "Drake Roar"], base: { STR:10, AGI:6, END:10, SPC:6, INT:6, WIS:6 }, img: "dragonknight.jpg" },

      { name: "Ninja", slug: "ninja", role: "Trickster", flavor: "A shadow in motion—swift, elusive, decisive.", abilities: ["Kunai Toss", "Smoke Puff", "Soft Step"], base: { STR:6, AGI:11, END:6, SPC:9, INT:6, WIS:6 }, img: "ninja.jpg" },
      { name: "Shadowrunner", slug: "shadowrunner", role: "Trickster", flavor: "A master infiltrator who slips through darkness and walls alike.", abilities: ["Shadow Dagger", "Shadow Veil", "Shadow Step"], base: { STR:6, AGI:10, END:6, SPC:10, INT:6, WIS:6 }, img: "shadowrunner.jpg" },
      { name: "Acrobat", slug: "acrobat", role: "Trickster", flavor: "Daring footwork and spinning strikes that bewilder foes.", abilities: ["Somersault Strike", "Spin Kick", "Flip"], base: { STR:6, AGI:11, END:7, SPC:8, INT:6, WIS:6 }, img: "acrobat.jpg" },
      { name: "Chainfighter", slug: "chainfighter", role: "Trickster", flavor: "Steel and motion—chains that bind and bite.", abilities: ["Chain Throw", "Chain Whip", "Chain Bind"], base: { STR:8, AGI:9, END:8, SPC:8, INT:5, WIS:6 }, img: "chainfighter.jpg" },
      { name: "Guardian", slug: "guardian", role: "Defender", flavor: "Unshakable stance; danger is welcomed and absorbed.", abilities: ["Guard Stance", "Challenge", "Steadfast"], base: { STR:9, AGI:6, END:11, SPC:7, INT:5, WIS:6 }, img: "guardian.jpg" },

      { name: "Pyromancer", slug: "pyromancer", role: "Arcane Destroyer", flavor: "Flame obeys; ash is a kind of certainty.", abilities: ["Flame Snap", "Fire Flicker", "Cinder Puff", "Ember Glint"], base: { STR:7, AGI:6, END:6, SPC:8, INT:11, WIS:6 }, img: "pyromancer.jpg" },
      { name: "Storm Mage", slug: "stormmage", role: "Arcane Destroyer", flavor: "Thunder answers the call; wind carries the strike.", abilities: ["Spark", "Breeze", "Chain Spark", "Breezy Flow"], base: { STR:5, AGI:7, END:6, SPC:9, INT:10, WIS:7 }, img: "stormmage.jpg" },
      { name: "Cryomancer", slug: "cryomancer", role: "Arcane Destroyer", flavor: "Winter sculpted into shards and silence.", abilities: ["Frost Pebble", "Icicle", "Cold Gust", "Cool Mist"], base: { STR:6, AGI:6, END:6, SPC:9, INT:10, WIS:7 }, img: "cryomancer.jpg" },
      { name: "Crystal Mage", slug: "crystalmage", role: "Arcane Destroyer", flavor: "Crystalline focus—barriers, blades, and refracted will.", abilities: ["Shard", "Shard Guard", "Shard Shield", "Shard Spike"], base: { STR:5, AGI:6, END:6, SPC:9, INT:10, WIS:8 }, img: "crystalmage.jpg" },
      { name: "Blood Mage", slug: "bloodmage", role: "Arcane Destroyer", flavor: "Life pays the price; devastation collects the debt.", abilities: ["Blood Gift", "Vein Grip", "Sanguine Burst", "Drain"], base: { STR:6, AGI:8, END:6, SPC:8, INT:10, WIS:6 }, img: "bloodmage.jpg" },

      { name: "Spirit Caller", slug: "spiritcaller", role: "Mystic", flavor: "Whispers to the dead; ancestors answer with power.", abilities: ["Ancestor Whisper", "Spirit Pulse", "Spirit Friend", "Ancestor's Aid"], base: { STR:5, AGI:6, END:6, SPC:8, INT:8, WIS:11 }, img: "spiritcaller.jpg" },
      { name: "Shaman", slug: "shaman", role: "Mystic", flavor: "Spirits and totems woven into rites of battle.", abilities: ["Totem Place", "Spirit Chant", "Great Totem", "Minor Rain"], base: { STR:6, AGI:6, END:7, SPC:8, INT:7, WIS:10 }, img: "shaman.jpg" },
      { name: "Oracle", slug: "oracle", role: "Mystic", flavor: "Sight bends fate; outcomes reveal themselves early.", abilities: ["Glimpse", "Coin Toss", "Hint", "Bend Fate"], base: { STR:5, AGI:5, END:6, SPC:9, INT:8, WIS:11 }, img: "oracle.jpg" },
      { name: "Runemaster", slug: "runemaster", role: "Mystic", flavor: "Sigils of power etched to weaken or detonate.", abilities: ["Rune Spark", "Rune Dull", "Rune Pop", "Rune Guard"], base: { STR:5, AGI:6, END:6, SPC:9, INT:9, WIS:9 }, img: "runemaster.jpg" },
      { name: "Dreamwalker", slug: "dreamwalker", role: "Mystic", flavor: "Steps between minds; dreams obey the daring.", abilities: ["Sleep Mist", "Mirage", "Walk in Dream", "Mind Glance"], base: { STR:5, AGI:6, END:7, SPC:8, INT:8, WIS:10 }, img: "dreamwalker.jpg" },

      { name: "Beastcaller", slug: "beastcaller", role: "Wild", flavor: "Primal bonds call loyal companions to your side.", abilities: ["Summon Companion", "Beast Instinct", "Big Beast"], base: { STR:7, AGI:7, END:7, SPC:8, INT:6, WIS:9 }, img: "beastcaller.jpg" },
      { name: "Druid", slug: "druid", role: "Wild", flavor: "Bark and thorn, fang and form—nature answers.", abilities: ["Thorn Whip", "Beast Form (Small)", "Tree Form"], base: { STR:6, AGI:6, END:8, SPC:7, INT:7, WIS:10 }, img: "druid.jpg" },
      { name: "Insect Tamer", slug: "insecttamer", role: "Wild", flavor: "Crawling legions directed with uncanny calm.", abilities: ["Swarm Rush", "Crawling Cover", "Insect Pulse"], base: { STR:6, AGI:7, END:7, SPC:9, INT:7, WIS:8 }, img: "insecttamer.jpg" },
      { name: "Lycanthrope", slug: "lycanthrope", role: "Wild", flavor: "The beast within—claws, howl, and terrible speed.", abilities: ["Claw Swipe", "Howl", "Wolf Form"], base: { STR:10, AGI:8, END:9, SPC:6, INT:5, WIS:6 }, img: "lycanthrope.jpg" },
      { name: "Dragonborn", slug: "dragonborn", role: "Wild", flavor: "Blood of dragons—breath of elements.", abilities: ["Dragon Breath", "Dragon Scales", "Mighty Breath"], base: { STR:9, AGI:7, END:8, SPC:7, INT:6, WIS:7 }, img: "dragonborn.jpg" },

      { name: "Bard", slug: "bard", role: "Specialist", flavor: "Words that embolden allies and unnerve foes.", abilities: ["Song of War", "Jeer Song", "Heroic Note"], base: { STR:6, AGI:7, END:8, SPC:8, INT:7, WIS:8 }, img: "bard.jpg" },
      { name: "Alchemist", slug: "alchemist", role: "Specialist", flavor: "Bottled chaos—bombs, brews, and quick fixes.", abilities: ["Throw Potion", "Quick Mix", "Big Flask"], base: { STR:6, AGI:7, END:7, SPC:9, INT:9, WIS:6 }, img: "alchemist.jpg" },
      { name: "Technomancer", slug: "technomancer", role: "Specialist", flavor: "Where circuits meet sigils and sparks become spells.", abilities: ["Spark Shot", "Gadget", "Toy Drone"], base: { STR:6, AGI:7, END:6, SPC:9, INT:10, WIS:6 }, img: "technomancer.jpg" },
      { name: "Witch Hunter", slug: "witchhunter", role: "Specialist", flavor: "Wards and bolts to break the will of witches.", abilities: ["Purify Bolt", "Resistance Field", "Seal Mark"], base: { STR:7, AGI:7, END:7, SPC:9, INT:6, WIS:8 }, img: "witchhunter.jpg" },
      { name: "Blood Knight", slug: "bloodknight", role: "Specialist", flavor: "A cursed blade that drinks deep and stands unbroken.", abilities: ["Blade Sacrifice", "Blood Shackles", "Blood Rush"], base: { STR:10, AGI:7, END:10, SPC:6, INT:5, WIS:6 }, img: "bloodknight.jpg" }
    ];

    const cardsContainer = document.getElementById('cards');
    const heroImg = document.getElementById('heroImg');
    const heroName = document.getElementById('heroName');
    const heroFlavor = document.getElementById('heroFlavor');
    const abilitiesSelection = document.getElementById('abilitiesSelection');
    const attrsContainer = document.getElementById('attrs');
    const pointsRemainingEl = document.getElementById('pointsRemaining');
    const continueBtn = document.getElementById('continueBtn');
    const charNameInput = document.getElementById('charName');

    // Summary elements
    const summaryModal = document.getElementById('summaryModal');
    const sumNameSpan = document.getElementById('sumName');
    const sumClassSpan = document.getElementById('sumClass');
    const sumAbilitiesSpan = document.getElementById('sumAbilities');
    const proceedBtn = document.getElementById('proceedBtn');
    const backBtn = document.getElementById('backBtn');

    let selected = null;
    let remainingPoints = 2;
    let currentValues = {};
    let selectedAbilities = [];

    // Initialize cards
    function buildCards() {
      cardsContainer.innerHTML = '';
      CLASSES.forEach(cls => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.slug = cls.slug;
        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        const img = document.createElement('img');
        img.src = 'images/' + (cls.img || 'placeholder.jpg');
        img.alt = cls.name;
        thumb.appendChild(img);
        const name = document.createElement('div');
        name.className = 'name';
        name.textContent = cls.name;
        card.appendChild(thumb);
        card.appendChild(name);
        card.addEventListener('click', () => selectClass(cls));
        cardsContainer.appendChild(card);
      });
    }

    function selectClass(cls) {
      selected = cls;
      document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
      const cardElem = document.querySelector('.card[data-slug="' + cls.slug + '"]');
      if (cardElem) cardElem.classList.add('selected');
      heroImg.src = 'images/' + (cls.img || 'placeholder.jpg');
      heroImg.alt = cls.name;
      heroName.textContent = cls.name;
      heroFlavor.textContent = cls.flavor;
      buildAbilitiesUI(cls);
      remainingPoints = 2;
      pointsRemainingEl.textContent = remainingPoints + ' points remaining';
      currentValues = { ...cls.base };
      buildAttributesUI();
      updateContinueState();
    }

    function buildAttributesUI() {
      attrsContainer.innerHTML = '';
      ['STR','AGI','END','SPC','INT','WIS'].forEach(attr => {
        const wrapper = document.createElement('div');
        wrapper.className = 'attr';
        const label = document.createElement('span');
        label.className = 'label';
        label.textContent = attr;
        const value = document.createElement('span');
        value.className = 'value';
        value.id = 'val_' + attr;
        value.textContent = currentValues[attr];
        const btn = document.createElement('button');
        btn.className = 'plus';
        btn.textContent = '+';
        btn.addEventListener('click', () => incrementAttr(attr, value, btn));
        wrapper.appendChild(label);
        wrapper.appendChild(value);
        wrapper.appendChild(btn);
        attrsContainer.appendChild(wrapper);
        updateButtonState(btn, attr);
      });
    }

    function buildAbilitiesUI(cls) {
      abilitiesSelection.innerHTML = '';
      selectedAbilities = [];
      if (!cls) return;
      cls.abilities.forEach(ab => {
        const chip = document.createElement('button');
        chip.className = 'ability-chip';
        chip.textContent = ab;
        chip.addEventListener('click', () => toggleAbility(ab, chip));
        abilitiesSelection.appendChild(chip);
      });
      updateAbilityChipsState();
    }

    function toggleAbility(ab, chip) {
      const idx = selectedAbilities.indexOf(ab);
      if (idx >= 0) {
        selectedAbilities.splice(idx, 1);
        chip.classList.remove('selected');
      } else {
        if (selectedAbilities.length >= 2) return;
        selectedAbilities.push(ab);
        chip.classList.add('selected');
      }
      updateAbilityChipsState();
      updateContinueState();
    }

    function updateAbilityChipsState() {
      const chips = abilitiesSelection.querySelectorAll('.ability-chip');
      const count = selectedAbilities.length;
      chips.forEach(chip => {
        const ab = chip.textContent;
        if (count >= 2 && !selectedAbilities.includes(ab)) { chip.classList.add('disabled'); }
        else { chip.classList.remove('disabled'); }
      });
    }

    function updateContinueState() {
      const nameFilled = charNameInput.value.trim().length > 0;
      const pointsSpent = remainingPoints === 0;
      const abilitiesChosen = selectedAbilities.length === 2;
      continueBtn.disabled = !(selected && nameFilled && pointsSpent && abilitiesChosen);
    }

    function incrementAttr(attr, valueEl, btn) {
      if (remainingPoints <= 0) return;
      if (currentValues[attr] >= 11) return;
      currentValues[attr] += 1;
      valueEl.textContent = currentValues[attr];
      remainingPoints -= 1;
      pointsRemainingEl.textContent = remainingPoints + ' points remaining';
      updateAllButtonsState();
      updateContinueState();
    }
    function updateButtonState(btn, attr) {
      if (!selected) { btn.disabled = true; return; }
      btn.disabled = remainingPoints <= 0 || currentValues[attr] >= 11;
    }
    function updateAllButtonsState() {
      document.querySelectorAll('.attr button.plus').forEach(btn => {
        const attr = btn.parentElement.querySelector('.label').textContent;
        btn.disabled = (remainingPoints <= 0) || (currentValues[attr] >= 11);
      });
    }
    buildCards();
    charNameInput.addEventListener('input', updateContinueState);

    // Save character and show summary
    continueBtn.addEventListener('click', () => {
      if (!selected || remainingPoints > 0 || selectedAbilities.length !== 2) return;
      const charName = charNameInput.value.trim();
      if (!charName) return;

      const character = {
        class: selected.slug,
        className: selected.name,
        name: charName,
        attributes: currentValues,
        abilities: selectedAbilities,
        classImg: selected.img || null           // ➜ Bild an Overview übergeben
      };
      try {
        // Hauptobjekt
          localStorage.setItem('character', JSON.stringify(character));
          sessionStorage.setItem('character', JSON.stringify(character)); // <--- NEU
        // Kompatible Einzelkeys (Overview liest teils diese)
        localStorage.setItem('character.name', character.name);
        localStorage.setItem('character.className', character.className);
        localStorage.setItem('character.class', character.class);
        localStorage.setItem('character.abilities', JSON.stringify(character.abilities));
        localStorage.setItem('character.attributes', JSON.stringify(character.attributes));
        localStorage.setItem('character.stats', JSON.stringify(character.attributes));
      } catch (err) {}

      sumNameSpan.textContent = charName;
      sumClassSpan.textContent = selected.name;
      sumAbilitiesSpan.textContent = selectedAbilities.join(', ');
      summaryModal.style.display = 'flex';
    });

    // Proceed: go to overview.html
    proceedBtn.addEventListener('click', () => {
      summaryModal.style.display = 'none';
      try { sessionStorage.setItem('ambientUnlock','1'); } catch(err) {}
      window.location.href = 'overview.html';   // ➜ Übergang zu Overview
    });

    backBtn.addEventListener('click', () => {
      summaryModal.style.display = 'none';
    });

    // Ensure ambient music plays on first interaction
    function tryPlayAmbient() {
      const amb = document.getElementById('ambient');
      if (amb) { amb.volume = 0.25; amb.play().then(()=>{ amb.muted=false; }).catch(()=>{}); }
    }
    document.addEventListener('click', function handler() { tryPlayAmbient(); document.removeEventListener('click', handler); });
    document.addEventListener('keydown', function handler() { tryPlayAmbient(); document.removeEventListener('keydown', handler); });
  </script>
</body>
</html>
